{% extends 'manage/index.html'%}
{% block manage_content %}
<div style="" class="main-content">
    {% include 'manage/partials/search.html'%}
    <div class="display-flex justify-content-space-between" style="margin-top: 20px;">
      <h2 class="title" style="color: #112A46;font-weight: 500; font-size: 1.5rem;">Missions</h2>
      <a href="/ajouter/mission" class="button is-primary is-small" title="Ajouter une mission"><i class="fa fa-plus"></i></a>
    </div>

    <section class="tile" style="margin-top: 10px;">
        <div class="box" style="  width: -webkit-fill-available; width:100%;">
          <div style="margin-bottom: 20px; display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
            <span><i class="fa fa-users"></i></span>
          </div>
          <div>
            <div class="display-flex" style="margin-top: 20px; margin-bottom: 10px;justify-content: space-evenly;">
              <form method="GET" action="{{url_for('users.mission')}}">
                <div class="columns">
                  <input type="text" name="keyword" placeholder="Recherche reference client ,Prix ht edl" class="input is-small " required value="{{search}}">
                  <button class="button is-small is-primary"> <i class="fas fa-search fa-sm"></i></button>
                </div>
              </form>    
              <form method="GET" action="{{url_for('users.mission')}}">
                <div class="columns">
                  <h>Trier par date edl</h>
                  <input type="date" name="date" placeholder="Recherche Mission" class="input is-small" required value="{{search}}">
                  <button class="button is-small is-primary"> <i class="fas fa-search fa-sm"></i></button>
                </div>
              </form>      
<<<<<<< HEAD
              <form method="POST" action="{{url_for('users.mission')}}">
                <div class="columns" style="display: flex;">
=======
              <form method="GET" action="{{url_for('users.mission')}}">
                <div class="colums" style="display: flex;">
>>>>>>> 18130d1f3a94d7bd62421db4c0245e6d02cb57d8
                <span class="select is-small is-fullwidth">
                  <select name="table" class="not">
                    <option value="mission">Ordre par id mission</option>
                    <option value="edl">Ordre par date EDL</option>
                    <option value="ht">Ordre par prix ht</option>
                    <option value="fac">Ordre par date FACTURE </option>
                  </select>
                </span>
                <span class="select is-small is-fullwidth">
                  <select name="table2" class="not">
                    <option value="asc">ASC</option>
                    <option value="desc">DESC</option>
                  </select>
                </span>
                  <input type="submit" class="button is-primary is-small" value="Ordre">
                </div>
              </form>      
            </div>
          </div>
          <div class="table-container" style="overflow-x: scroll;position: relative;">
            {% with messages = get_flashed_messages(with_categories=true)%}
                {% if messages %}
                    {%for category,message in messages%}
                    <div class="alert alert-{{category}} p-1">
                        {{message}}
                    </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <table class="table"  style="overflow-x: scroll;min-width: 800px;"> 
	                    <thead class="">
                       
	                	<tr>    <th scope="col">ID</th>
                            <th scope="col">Reference BAILLEUR</th>  	 
                            <th scope="col">ID CONCESS</th>	  
                            <th scope="col">DATE EDL REALISE</th>  	
                            <th scope="col">PRIX HT EDL</th>	  	     	
                            <th scope="col">DATE FACTURE</th>  	  		
                            <th></th>	
                            <th></th>
                            <th></th>
	                	</tr>
	            	</thead>
		            <tbody>
		                {%for mission_ in Mission.items %}
		                    <tr>    
                                <td>{{mission_.id}}</td> 
                                <td>{{mission_.Bailleur__data.reference}}</td>     	   
                                <td>{{mission_.AS__data.nom}}</td> 	  
                                <td>
                                  {% if mission_.DATE_REALISE_EDL != None %}     {{mission_.DATE_REALISE_EDL.strftime('%d. %m. %Y') }}
                                  {% else %}
                                  aucune date
                                  {% endif %}
                                </td>  	
                                <td>
                                  {% if mission_.PRIX_HT_EDL == None %}
                                    aucune date
                                  {% else %}
                                    {{ mission_.PRIX_HT_EDL }}
                                  {% endif %}               
                                </td> 	    
                                <td>
                                  {% if mission_.DATE_FACTURE == None %}
                                    aucune date
                                  {% else %}
                                    {{ mission_.DATE_FACTURE }}
                                  {% endif %}                              
                                </td>   	 	  	  
                                <td><a href="{{url_for('users.edit_mission', id=mission_.id)}}" class=" is-small is-outlined-black is-fullwidth button"><i class="fa fa-pen"></i></a></td>	 
                                <td> <a href="{{url_for('users.delete_mission', id=mission_.id)}}" onclick="return confirm('Voulez vous supprimer?')" title="supprimer" class=" is-small is-danger is-fullwidth button"><i class="fa fa-trash"></i></a></td>
                                <td style="">
                                    <a href="{{url_for('users.show_mission', id=mission_.id)}}" title="voir tout les details" class="button is-small is-primary is-fullwidth" style="text-align: center"><i class="fa fa-eye"></i></a>
                                    
                                </td>
		                    </tr> 
		                {%endfor%}                     
		            </tbody>         
	             </table>
	            </div>
                 <!-- Pagination Links-->
                <nav class="pagination" role="navigation" aria-label="pagination">
                  <ul class="pagination-list">
                    {% for page_num in Mission.iter_pages(left_edge=1,right_edge=1,left_current=1,right_current=2) %}
                    {% if page_num %}
<<<<<<< HEAD
                      {% if Mission.page == page_num %}
                        <li>
                          <a class="pagination-link" href="{{ url_for('users.mission',page=page_num) }}">{{page_num}}</a>
                        </li>
                    {% else %} 
                        <li>
                          <a class="pagination-link" href="{{ url_for('users.mission',page=page_num) }}">{{page_num}}</a>
                        </li>
                     {% endif %}
=======
                      {% if key %}
                        {% if request.referrer[30:37] == 'keyword' %}
                        <a class="btn btn-info mb-4" href="{{ url_for('users.mission',keyword=key,page=page_num) }}">{{page_num}}</a>
                        {% else %} 
                        <a class="btn btn-outline-info mb-4" href="{{ url_for('users.mission',keyword=key,page=page_num) }}">{{page_num}}</a>
                        {% endif %}
                      {% endif %}
                      {% if date %}
                        {% if request.referrer[30:34] == 'date' %}
                        <a class="btn btn-info mb-4" href="{{ url_for('users.mission',date=date,page=page_num) }}">{{page_num}}</a>
                        {% else %} 
                        <a class="btn btn-outline-info mb-4" href="{{ url_for('users.mission',date=date,page=page_num) }}">{{page_num}}</a>
                        {% endif %}
                      {% endif %}
                      {% if table and table2 %}
                      <a class="btn btn-info mb-4" href="{{ url_for('users.mission',table=table,table2=table2,page=page_num) }}">{{page_num}}</a>
                      {% else %} 
                      <a class="btn btn-outline-info mb-4" href="{{ url_for('users.mission',table=table,table2=table2,date=date,page=page_num) }}">{{page_num}}</a>
                      {% endif %}
                      {% if not date and not key and not table %}
                        {% if Mission.page == page_num %}
                        <a class="btn btn-info mb-4" href="{{ url_for('users.mission',page=page_num) }}">{{page_num}}</a>
                        {% else %} 
                        <a class="btn btn-outline-info mb-4" href="{{ url_for('users.mission',page=page_num) }}">{{page_num}}</a>
                        {% endif %}
                      {% endif %}
>>>>>>> 18130d1f3a94d7bd62421db4c0245e6d02cb57d8
                    {% else %}
                        ....
                    {% endif %}
                  {% endfor %}
                  </ul>
                </nav>
            <!-- / fin de la pagination -->
	        </div>
        </section>
	    </div>
      <script type="text/javascript">
        $(document).ready(function() {
            var table = $('#table_id').DataTable();
        
            $('#table_id tbody').on( 'click', 'tr', function () {
                if ( $(this).hasClass('selected') ) {
                    $(this).removeClass('selected');
                }
                else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            } );
        
            $('#button').click( function () {
                table.row('.selected').remove().draw( false );
            } );
        } );
    </script>

{% endblock %}


